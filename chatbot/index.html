<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="pageTitle">Chatbot Futuriste</title>
<style>
  * {margin:0;padding:0;box-sizing:border-box;}
  body {
    font-family: 'Orbitron', sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: #0a0a0a;
    color: white;
    overflow: hidden;
    cursor: none;
  }

  /* Fond anim√© */
  #bgCanvas {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index:-1;
  }

  h1 {
    text-align:center;
    padding:1rem;
    font-size:2.5rem;
    color:#00ffe5;
    text-shadow:0 0 10px #00ffe5,0 0 20px #00ffe5;
    animation:flicker 2s infinite;
    z-index:1;
  }

  @keyframes flicker {
    0%,19%,21%,23%,25%,54%,56%,100% {opacity:1;}
    20%,24%,55% {opacity:0.3;}
  }

  .chat-container {
    flex:1;
    overflow-y:auto;
    padding:1rem;
    display:flex;
    flex-direction:column;
    gap:1rem;
    z-index:1;
    position:relative;
  }

  .message {
    max-width:70%;
    padding:1rem;
    border-radius:15px;
    line-height:1.4;
    animation:fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from {opacity:0; transform:translateY(10px);}
    to {opacity:1; transform:translateY(0);}
  }

  .user {
    align-self:flex-end;
    background: rgba(0,255,229,0.2);
    border:1px solid #00ffe5;
    box-shadow:0 0 10px #00ffe5;
  }

  .bot {
    align-self:flex-start;
    background: rgba(255,0,255,0.15);
    border:1px solid #ff00ff;
    box-shadow:0 0 10px #ff00ff;
  }

  .input-container {
    display:flex;
    padding:1rem;
    background: rgba(0,0,0,0.3);
    border-top:1px solid rgba(255,255,255,0.1);
    z-index:1;
    position:relative;
  }

  .input-container input {
    flex:1;
    padding:0.8rem 1rem;
    border:none;
    border-radius:30px;
    outline:none;
    font-family:inherit;
    font-size:1rem;
    background: rgba(255,255,255,0.1);
    color:white;
    box-shadow:0 0 10px #00ffe5;
  }

  .input-container button {
    margin-left:1rem;
    padding:0.8rem 1.2rem;
    border:none;
    border-radius:30px;
    cursor:pointer;
    font-family:inherit;
    font-size:1rem;
    background:#00ffe5;
    color:#0f0c29;
    font-weight:bold;
    transition:0.3s;
    box-shadow:0 0 10px #00ffe5,0 0 20px #00ffe5;
  }

  .input-container button:hover {
    background:#ff00ff;
    box-shadow:0 0 20px #ff00ff,0 0 40px #ff00ff;
    color:white;
  }

  /* Curseur custom */
  .cursor {
    position:fixed;
    top:0; left:0;
    width:25px; height:25px;
    border:2px solid #00ffe5;
    border-radius:50%;
    pointer-events:none;
    transform:translate(-50%,-50%);
    transition:transform 0.15s ease-out,width 0.2s,height 0.2s,border 0.2s;
    z-index:1000;
    box-shadow:0 0 10px #00ffe5,0 0 20px #00ffe5;
    mix-blend-mode:difference;
  }

  /* Fl√®che retour + overlay */
  .back-arrow {
    position:fixed;
    top:20px; left:20px;
    font-size:2rem;
    color:#00ffe5;
    text-shadow:0 0 10px #00ffe5,0 0 20px #00ffe5;
    cursor:pointer;
    z-index:1001;
    transition:transform 0.3s,color 0.3s;
  }
  .back-arrow:hover {
    transform:scale(1.2) rotate(-10deg);
    color:#ff00ff;
  }

  .overlay {
    position:fixed;
    top:50%;
    left:50%;
    width:0; height:0;
    background:radial-gradient(circle,#00ffe5 0%,#ff00ff 70%);
    border-radius:50%;
    z-index:1000;
    pointer-events:none;
    transition: width 1.5s ease,height 1.5s ease,top 1.5s ease,left 1.5s ease;
  }
  .overlay.active {
    width:300vw; height:300vw;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
  }

  .language-switcher {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 100;
    display: flex;
    gap: 10px;
  }

  .language-switcher img {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(0,255,229,0.6);
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .language-switcher img:hover {
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(0,255,229,1);
  }

  .language-switcher img.active-lang {
    border: 2px solid #ff00ff;
    box-shadow: 0 0 15px #ff00ff;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
</head>
<body>

<canvas id="bgCanvas"></canvas>
<div class="back-arrow" id="backArrow">‚¨Ö</div>
<div class="overlay" id="overlay"></div>

<h1 id="chatTitle">ü§ñ Chat avec mon IA</h1>
<div class="chat-container" id="chat"></div>

<div class="input-container">
  <input type="text" id="userInput" placeholder="√âcris ton message...">
  <button onclick="sendMessage()" id="sendButton">Envoyer</button>
</div>

<div class="language-switcher">
    <img src="../assets/fr.png" alt="Fran√ßais" onclick="setLanguage('fr')" id="lang-fr" class="active-lang">
    <img src="../assets/en.png" alt="English" onclick="setLanguage('en')" id="lang-en">
    </div>

<div class="cursor" id="cursor"></div>

<script>
  const translations = {
    fr: {
      pageTitle: "Chatbot Futuriste",
      chatTitle: "ü§ñ Chat avec mon IA",
      inputPlaceholder: "√âcris ton message...",
      sendButton: "Envoyer",
      errorConnecting: "Erreur de connexion au backend, r√©essaie plus tard."
    },
    en: {
      pageTitle: "Futuristic Chatbot",
      chatTitle: "ü§ñ Chat with my AI",
      inputPlaceholder: "Type your message...",
      sendButton: "Send",
      errorConnecting: "Error connecting to the backend, please try again later."
    }
  };

  function setLanguage(lang) {
    document.documentElement.lang = lang;
    localStorage.setItem('lang', lang);

    document.getElementById('pageTitle').textContent = translations[lang].pageTitle;
    document.getElementById('chatTitle').textContent = translations[lang].chatTitle;
    document.getElementById('userInput').placeholder = translations[lang].inputPlaceholder;
    document.getElementById('sendButton').textContent = translations[lang].sendButton;

    // G√©rer la classe active pour les drapeaux
    document.querySelectorAll('.language-switcher img').forEach(img => {
      img.classList.remove('active-lang');
    });
    document.getElementById('lang-' + lang).classList.add('active-lang');
  }

  document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('lang') || 'fr';
    setLanguage(savedLang);

    // ===== Curseur custom =====
    const cursor = document.getElementById("cursor");
    window.addEventListener("mousemove", e => {
      cursor.style.top = e.clientY + "px";
      cursor.style.left = e.clientX + "px";
    });

    // ===== Fond anim√© √©toiles =====
    const canvas = document.getElementById("bgCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particles = Array.from({length:150},()=>({
      x:Math.random()*canvas.width,
      y:Math.random()*canvas.height,
      radius:Math.random()*2+1,
      dx:(Math.random()-0.5)*0.5,
      dy:(Math.random()-0.5)*0.5
    }));

    let mouse = {x:canvas.width/2,y:canvas.height/2};
    window.addEventListener("mousemove", e=>{mouse.x=e.clientX;mouse.y=e.clientY;});

    function animate(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach(p=>{
        let dx = mouse.x - p.x;
        let dy = mouse.y - p.y;
        let dist = Math.sqrt(dx*dx+dy*dy);
        if(dist<150){p.x-=dx*0.005;p.y-=dy*0.005;}
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);
        ctx.fillStyle="#00ffe5";
        ctx.shadowColor="#00ffe5";
        ctx.shadowBlur=10;
        ctx.fill();
        p.x+=p.dx;
        p.y+=p.dy;
        if(p.x<0||p.x>canvas.width)p.dx*=-1;
        if(p.y<0||p.y>canvas.height)p.dy*=-1;
      });
      requestAnimationFrame(animate);
    }
    animate();

    // ===== Chatbot =====
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");

    function addMessage(text,sender){
      const msg=document.createElement("div");
      msg.classList.add("message",sender);
      msg.textContent=text;
      chat.appendChild(msg);
      chat.scrollTop=chat.scrollHeight;
    }

    async function getGeminiResponse(prompt){
      try{
        const response = await fetch("http://localhost:3000/chat",{ // On appelle bien votre backend
          method:"POST",
          headers:{
            "Content-Type":"application/json",
          },
          body:JSON.stringify({
            message: prompt // On envoie la cl√© "message" que le backend attend
          })
        });
        const data = await response.json();
        return data.reply; // On retourne la r√©ponse du backend
      } catch(err){
        console.error(err);
        return translations[localStorage.getItem('lang') || 'fr'].errorConnecting;
      }
    }

    async function sendMessage(){
      const msg=input.value.trim();
      if(msg!==""){
        addMessage(msg,"user");
        input.value="";
        const botReply = await getGeminiResponse(msg);
        addMessage(botReply,"bot");
      }
    }

    input.addEventListener("keypress",e=>{
      if(e.key==="Enter"){e.preventDefault();sendMessage();}
    });

    // ===== Fl√®che retour futuriste =====
    const backArrow = document.getElementById("backArrow");
    const overlay = document.getElementById("overlay");

    backArrow.addEventListener("click", ()=>{
      overlay.classList.add("active");
      setTimeout(()=>{ window.location.href="../index.html"; },1500);
    });
  });
</script>
</body>
</html>